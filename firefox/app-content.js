(function(){const s={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_VIDEO_INFO:"GET_VIDEO_INFO",RESULT_VIDEO_INFO:"RESULT_VIDEO_INFO",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION",CHECK_CONNECTION_UI:"CHECK_CONNECTION_UI",APP_INSTANCE_ALIVE:"APP_INSTANCE_ALIVE",APP_INSTANCE_LOST_PRIMARY:"APP_INSTANCE_LOST_PRIMARY",APP_INSTANCE_NOW_PRIMARY:"APP_INSTANCE_NOW_PRIMARY",DISPLAY_VIDEOS_ON_SELECTED_PAGE:"DISPLAY_VIDEOS_ON_SELECTED_PAGE"},a=E=>new Promise((e,_)=>{chrome.runtime.sendMessage(E,T=>{chrome.runtime.lastError?_(chrome.runtime.lastError.message):e(T)})}),n=E=>{window.postMessage(E,"*")};a({cmd:s.APP_INSTANCE_ALIVE,tabId:chrome.runtime.id});const N={[s.APP_INSTANCE_NOW_PRIMARY]:async()=>(console.log("Ahiseve extension:","ahora la pesta\xF1a Ahiseve esta conectado a la extension"),console.log("la extension solo puede conectarse con una pesta\xF1a de Ahiseve"),n({cmd:s.APP_INSTANCE_NOW_PRIMARY}),{status:"ok"}),[s.APP_INSTANCE_LOST_PRIMARY]:async()=>(console.log("Ahiseve extension:","esta pesta\xF1a dejo de ser la principal y se desconecto de la extension"),n({cmd:s.APP_INSTANCE_LOST_PRIMARY}),{status:"ok"}),[s.ELEMENT_ACTION]:async E=>(E.data.status=="sending"&&n({cmd:E.cmd,data:E.data}),{status:"ok"}),[s.RESULT_VIDEOS_DATA]:async E=>(n(E),{status:"ok"}),[s.CHECK_CONNECTION]:async()=>({message:"connected"})},A={[s.ELEMENT_ACTION]:async({cmd:E,data:e})=>{e.status=="received"&&a({cmd:E,data:e}).catch(_=>{console.log(_)})},[s.CHECK_ELEMENT_VIDEO_SELECTED]:async({cmd:E,data:e})=>{const _=await a({cmd:E,data:e});_&&n(_)},[s.GET_TABS]:async({cmd:E,data:e})=>{const _=await a({cmd:E,data:e});_&&n(_)},[s.ADD_EVENTS_ELEMENT]:async({cmd:E,data:e})=>{await a({cmd:E,data:e})},[s.GET_VIDEO_INFO]:async({cmd:E,data:e})=>{n(await a({cmd:E,data:e}))},[s.DISPLAY_VIDEOS_ON_SELECTED_PAGE]:async({cmd:E,data:e})=>{await a({cmd:E,data:e})}};window.addEventListener("message",async function(E){const e=E.data;if(E.source!=window||e._isExtMsg)return;const _=A[e.cmd];if(_)try{await _(e)}catch(T){console.log(T)}},!1),chrome.runtime.onMessage.addListener(function(E,e,_){let T=N[E.cmd];return T?(T(E).then(t=>{_(t)}).catch(t=>{_({err:t})}),!0):!1}),console.log("ahiseve app")})();
