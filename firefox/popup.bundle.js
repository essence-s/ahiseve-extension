(function(){const o={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION"},d=e=>new Promise((t,a)=>{chrome.runtime.sendMessage(e,r=>{chrome.runtime.lastError?a(chrome.runtime.lastError.message):t(r)})}),s=(e,t)=>new Promise((a,r)=>{chrome.tabs.sendMessage(parseInt(e),t,g=>{chrome.runtime.lastError?r(chrome.runtime.lastError.message):a(g)})});function E(e,t){t=="no-connect"?e.classList.add("no-conect"):e.classList.remove("no-conect"),e.innerHTML=`
        <p>
            Video Seleccionado
            <img src='${n.favIconUrl}' crossorigin="anonymous" class="data-save-img-icon" />
        </p>
        <img src=${n.imgCover} class='img-option'> 
    `}function l(e){dataVideos.innerHTML=e.map(t=>`<img class='img-option' tabId='${t.tabId}' imgNumber="${t.number}" src="${t.img}" > `).join("")}function m(){let e={selected:!1};Object.keys(n).length!=0&&(e={selected:!0}),chrome.tabs.query({url:["https://ahiseve.vercel.app/*","http://localhost:4321/*"]},t=>{t.forEach(a=>{s(a.id,{cmd:o.RESULT_CHECK_ELEMENT_VIDEO_SELECTED,data:e})})})}let n={tabId:"",imgNumber:"",imgCover:"",favIconUrl:""},i=localStorage.getItem("dataG");i&&(n=JSON.parse(i),s(parseInt(n.tabId),{cmd:o.CHECK_CONNECTION}).then(e=>{e.message=="connected"&&E(dataSaveVideo)}).catch(e=>{console.log("Error al enviar mensaje:",e),E(dataSaveVideo,"no-connect")})),setTimeout(()=>{chrome.tabs.query({},function(e){try{dataTabs.innerHTML=e.map(t=>`<div class="tab-title" dataID='${t.id}'>
                    <img src='${t.favIconUrl}' crossorigin="anonymous" /> ${t.title}
                </div >`).join("")}catch(t){console.log(t)}})},100),dataTabs.addEventListener("click",e=>{if(e.target.classList.contains("tab-title")){let t=e.target.getAttribute("dataID");window.location.href="#dataVideos",s(parseInt(t),{cmd:o.GET_VIDEOS_DATA}).then(a=>{console.log("Mensaje enviado:",a)}).catch(a=>{console.log("Error al enviar mensaje:",a),chrome.scripting.executeScript({target:{tabId:parseInt(t),allFrames:!0},files:["content.bundle.js"]}).then(()=>{console.log("script injected in all jaus"),s(parseInt(t),{cmd:o.GET_VIDEOS_DATA}).then(r=>{console.log("Mensaje enviado:",r)}).catch(r=>{console.log("Error al enviar mensaje 2:",r)})})})}}),dataVideos.addEventListener("click",e=>{if(e.target.classList.contains("img-option")){const t=()=>{n.imgNumber=e.target.getAttribute("imgNumber"),n.imgCover=e.target.src,n.tabId=e.target.getAttribute("tabId"),chrome.tabs.get(parseInt(e.target.getAttribute("tabId")),function(a){n.favIconUrl=a.favIconUrl,localStorage.setItem("dataG",JSON.stringify(n)),d({cmd:"updateDataG",data:n}),E(dataSaveVideo),s(parseInt(n.tabId),{cmd:o.ADD_EVENTS_ELEMENT,data:{idNumber:n.imgNumber}}),m()})};n.tabId==""?t():s(parseInt(n.tabId),{cmd:o.REMOVE_EVENTS_ELEMENTS,data:{idNumber:n.imgNumber}}).then(a=>{a.status=="ok"&&t()}).catch(a=>{console.log("error remove",a),t()})}});let T=[],c=[];chrome.runtime.onMessage.addListener(function(e,t,a){e.cmd=="responseIMGS"?(c.push(e.data.map(r=>({...r,tabId:t.tab.id}))),l(c.flat())):e.cmd=="ElementVideo"&&T.push(e.data.id),a("no se encontro coincidencia")})})();
