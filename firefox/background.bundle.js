(function(){const c={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION"},o=(a,t)=>new Promise((E,e)=>{chrome.tabs.sendMessage(parseInt(a),t,n=>{chrome.runtime.lastError?e(chrome.runtime.lastError.message):E(n)})}),i={},l=async a=>{if(!a)return"";if(i[a])return i[a];try{const t=await fetch(a);if(!t.ok)return"";const E=await t.blob(),e=new FileReader,n=await new Promise(r=>{e.onloadend=()=>r(e.result),e.readAsDataURL(E)});return i[a]=n,n}catch{return""}},d=()=>new Promise((a,t)=>{try{chrome.tabs.query({},function(E){Promise.all(E.map(async e=>{const n=await l(e.favIconUrl);return{id:e.id,favIconUrl:n,title:e.title,url:e.url}})).then(e=>a(e))})}catch(E){console.log(E),t(E)}}),T=(a,t)=>new Promise((E,e)=>{o(parseInt(a),t).then(n=>{console.log("Mensaje enviado:",n),E(n)}).catch(n=>{console.log("Error al enviar mensaje:",n),browser.scripting.executeScript({target:{tabId:parseInt(a),allFrames:!0},files:["content.bundle.js"]}).then(()=>{console.log("script injected in all jaus"),o(parseInt(a),t).then(r=>{console.log("Mensaje enviado:",r),E(r)}).catch(r=>{console.log("Error al enviar mensaje 2:",r),e(r)})})})});chrome.runtime.onInstalled.addListener(()=>{console.log("installed")}),chrome.tabs.query({url:["https://ahiseve.vercel.app/*","http://localhost:4321/*"]},a=>{a.forEach(t=>{o(t.id,{cmd:c.CHECK_CONNECTION}).then(E=>{E.message=="connected"&&console.log(E,"ya esta conectado")}).catch(E=>{chrome.scripting.executeScript({target:{tabId:parseInt(t.id)},files:["content.bundle.js"]}).then(()=>{console.log("script injected")})})})});let s={};function _(){return new Promise(a=>{Object.keys(s).length==0?chrome.storage.local.get(["dataG"],function(t){t.dataG&&(s=JSON.parse(t.dataG)),a("")}):a("")})}chrome.runtime.onMessage.addListener(function(a,t,E){return _().then(async()=>{if(a.cmd=="updateDataG")s=a.data,chrome.storage.local.set({dataG:JSON.stringify(a.data)},function(){console.log("Datos almacenados en el localStorage del background:")});else if(a.cmd==c.ELEMENT_ACTION)a.data.status=="sending"?chrome.tabs.query({url:["https://ahiseve.vercel.app/*","http://localhost:4321/*"]},e=>{e.forEach(n=>{o(n.id,{cmd:a.cmd,data:a.data})})}):o(parseInt(s.tabId),{cmd:a.cmd,data:{...a.data,idNumber:s.imgNumber}});else if(a.cmd==c.CHECK_ELEMENT_VIDEO_SELECTED){let e={selected:!1};Object.keys(s).length!=0&&(e={selected:!0}),o(t.tab.id,{cmd:c.RESULT_CHECK_ELEMENT_VIDEO_SELECTED,data:e})}else if(a.cmd==c.GET_TABS){const e=await d();E({...a,cmd:c.RESULT_TABS,data:e})}else a.cmd==c.GET_VIDEOS_DATA?T(a.data.tabId,{...a,myTabId:t.tab.id}):a.cmd==c.RESULT_VIDEOS_DATA&&o(a.myTabId,{...a,cmd:c.RESULT_VIDEOS_DATA,data:a.data});E({data:"no se encontro coincidencia"})}),!0})})();
