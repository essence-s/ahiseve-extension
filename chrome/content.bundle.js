import{i,o as s,r as g}from"./util-CtUzdBzx.js";function f(){let e=[],t=!1;return async o=>{if(e.push(o),!t){for(t=!0;e.length;)await e.shift()();t=!1}}}let r=f();function c(e){i({cmd:s.ELEMENT_ACTION,data:{action:"play",status:"sending"}}).catch(t=>{console.log(t)})}function E(e){i({cmd:s.ELEMENT_ACTION,data:{action:"pause",status:"sending"}}).catch(t=>{console.log(t)})}function u(e){i({cmd:s.ELEMENT_ACTION,data:{action:"seeked",status:"sending",mediaCurrentTime:e.target.currentTime}}).catch(t=>{console.log(t)})}function T(e){e.addEventListener("play",c),e.addEventListener("pause",E),e.addEventListener("seeking",u)}function v(e){e.removeEventListener("seeking",u),e.removeEventListener("play",c),e.removeEventListener("pause",E)}function l(e,t,n,o){return new Promise(a=>{if(t=="pause"&&e.paused==!0||t=="play"&&e.paused==!1)return a("no genero evento con exito");e.removeEventListener(t,n);const m=()=>{e.addEventListener(t,n),e.removeEventListener(t,m),a("no genero evento con exito")};e.addEventListener(t,m),o()})}function _(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<8;o++){const a=Math.floor(Math.random()*62);n+=e.charAt(a)}return n}function L(e){try{e.crossOrigin="anonymous";let t=document.createElement("canvas");return t.width=100,t.height=56,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")}catch(t){console.log(t)}}let d=[];function h(){let e=document.querySelectorAll("video");const t=Array.from(e).map((n,o)=>{let a=L(n);return{number:_(),img:a,element:n}});return d=t,t.map(n=>({number:n.number,img:n.img}))}const p={ELEMENT_ACTION:e=>{if(e.data.status=="received"){let t=d.find(n=>n.number==e.data.idNumber);if(t){let n=t.element;e.data.action=="play"?r(async()=>{await l(n,"play",c,()=>{t.element.play()})}):e.data.action=="pause"?r(async()=>{await l(n,"pause",E,()=>{t.element.pause()})}):e.data.action=="seeked"&&r(async()=>{await l(n,"seeking",u,()=>{e.data.dataSeek?n.currentTime=Math.max(0,n.currentTime+e.data.dataSeek):n.currentTime=Math.max(0,e.data.mediaCurrentTime)})})}}else e.data.status=="sending"&&window.postMessage({cmd:e.cmd,data:e.data},"*");return{status:"ok"}},GET_VIDEOS_DATA:async(e,t)=>{let n=h();return i({...e,cmd:s.RESULT_VIDEOS_DATA,data:n}),{status:"ok"}},RESULT_VIDEOS_DATA:async(e,t)=>(g(e),{status:"ok"}),RESULT_CHECK_ELEMENT_VIDEO_SELECTED:e=>(window.postMessage({cmd:s.RESULT_CHECK_ELEMENT_VIDEO_SELECTED,data:e.data},"*"),{status:"ok"}),ADD_EVENTS_ELEMENT:e=>{let t=d.find(n=>n.number==e.data.idNumber);return t&&(console.log("addEvents",e),T(t.element)),{status:"ok"}},REMOVE_EVENTS_ELEMENTS:e=>{let t=d.find(n=>n.number==e.data.idNumber);return t&&(console.log("Remove Events",e),v(t.element)),{status:"ok"}},CHECK_CONNECTION:()=>({message:"connected"})},M={ELEMENT_ACTION:(e,t)=>{t.status=="received"&&i({cmd:e,data:t}).catch(n=>{console.log(n)})},CHECK_ELEMENT_VIDEO_SELECTED:(e,t)=>{i({cmd:e,data:t})},[s.GET_TABS]:async(e,t)=>{const n=await i({cmd:e,data:t});n&&g(n)},[s.GET_VIDEOS_DATA]:async(e,t)=>{await i({cmd:e,data:t})}};window.addEventListener("message",async function(e){const t=e.data;if(e.source!=window||t._isExtMsg)return;let{cmd:n,data:o}=t;const a=await M[n];a&&a(n,o)},!1),chrome.runtime.onMessage.addListener(function(e,t,n){let o=p[e.cmd];if(o)return o(e,t).then(a=>{n(a)}).catch(a=>{n({err:a})}),!0;n({error:"no existe tal accion"})}),console.log("media-element-selection-extension");
