(function(){const _={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION",APP_INSTANCE_ALIVE:"APP_INSTANCE_ALIVE",APP_INSTANCE_LOST_PRIMARY:"APP_INSTANCE_LOST_PRIMARY",APP_INSTANCE_NOW_PRIMARY:"APP_INSTANCE_NOW_PRIMARY"},a=E=>new Promise((e,s)=>{chrome.runtime.sendMessage(E,t=>{chrome.runtime.lastError?s(chrome.runtime.lastError.message):e(t)})}),n=E=>{window.postMessage(E,"*")};a({cmd:_.APP_INSTANCE_ALIVE,tabId:chrome.runtime.id});const o={[_.APP_INSTANCE_NOW_PRIMARY]:async()=>(console.log("Ahiseve extension:","ahora la pesta\xF1a Ahiseve esta conectado a la extension"),console.log("la extension solo puede conectarse con una pesta\xF1a de Ahiseve"),n({cmd:_.APP_INSTANCE_NOW_PRIMARY}),{status:"ok"}),[_.APP_INSTANCE_LOST_PRIMARY]:async()=>(console.log("Ahiseve extension:","esta pesta\xF1a dejo de ser la principal y se desconecto de la extension"),n({cmd:_.APP_INSTANCE_LOST_PRIMARY}),{status:"ok"}),[_.ELEMENT_ACTION]:async E=>(E.data.status=="sending"&&n({cmd:E.cmd,data:E.data}),{status:"ok"}),[_.RESULT_VIDEOS_DATA]:async E=>(n(E),{status:"ok"}),[_.CHECK_CONNECTION]:async()=>({message:"connected"})},A={[_.ELEMENT_ACTION]:async({cmd:E,data:e})=>{e.status=="received"&&a({cmd:E,data:e}).catch(s=>{console.log(s)})},[_.CHECK_ELEMENT_VIDEO_SELECTED]:async({cmd:E,data:e})=>{const s=await a({cmd:E,data:e});s&&n(s)},[_.GET_TABS]:async({cmd:E,data:e})=>{const s=await a({cmd:E,data:e});s&&n(s)},[_.GET_VIDEOS_DATA]:async({cmd:E,data:e})=>{await a({cmd:E,data:e})},[_.ADD_EVENTS_ELEMENT]:async({cmd:E,data:e})=>{await a({cmd:E,data:e})}};window.addEventListener("message",async function(E){const e=E.data;if(E.source!=window||e._isExtMsg)return;const s=A[e.cmd];s&&await s(e)},!1),chrome.runtime.onMessage.addListener(function(E,e,s){let t=o[E.cmd];if(t)return t(E).then(T=>{s(T)}).catch(T=>{s({err:T})}),!0;s({error:"no existe tal accion"})}),console.log("ahiseve app")})();
