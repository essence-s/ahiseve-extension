(function(){const e={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_VIDEO_INFO:"GET_VIDEO_INFO",RESULT_VIDEO_INFO:"RESULT_VIDEO_INFO",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION",CHECK_CONNECTION_UI:"CHECK_CONNECTION_UI",APP_INSTANCE_ALIVE:"APP_INSTANCE_ALIVE",APP_INSTANCE_LOST_PRIMARY:"APP_INSTANCE_LOST_PRIMARY",APP_INSTANCE_NOW_PRIMARY:"APP_INSTANCE_NOW_PRIMARY",DISPLAY_VIDEOS_ON_SELECTED_PAGE:"DISPLAY_VIDEOS_ON_SELECTED_PAGE",HIDDEN_UI:"HIDDEN_UI",SAVE_TAB_INFO:"SAVE_TAB_INFO",ENABLE_VIDEO_DETECTOR:"ENABLE_VIDEO_DETECTOR",DISABLE_VIDEO_DETECTOR:"DISABLE_VIDEO_DETECTOR",VIDEO_DETECTOR_STATUS:"VIDEO_DETECTOR_STATUS"},s=E=>new Promise((_,T)=>{chrome.runtime.sendMessage(E,n=>{chrome.runtime.lastError?T(chrome.runtime.lastError.message):_(n)})}),a=E=>{window.postMessage(E,"*")};s({cmd:e.APP_INSTANCE_ALIVE,tabId:chrome.runtime.id});const A={[e.APP_INSTANCE_NOW_PRIMARY]:async()=>(console.log("Ahiseve extension:","ahora la pesta\xF1a Ahiseve esta conectado a la extension"),console.log("la extension solo puede conectarse con una pesta\xF1a de Ahiseve"),a({cmd:e.APP_INSTANCE_NOW_PRIMARY}),{status:"ok"}),[e.APP_INSTANCE_LOST_PRIMARY]:async()=>(console.log("Ahiseve extension:","esta pesta\xF1a dejo de ser la principal y se desconecto de la extension"),a({cmd:e.APP_INSTANCE_LOST_PRIMARY}),{status:"ok"}),[e.ELEMENT_ACTION]:async E=>(E.data.status=="sending"&&a({cmd:E.cmd,data:E.data}),{status:"ok"}),[e.RESULT_VIDEOS_DATA]:async E=>(a(E),{status:"ok"}),[e.CHECK_CONNECTION]:async()=>({message:"connected"}),[e.VIDEO_DETECTOR_STATUS]:async E=>(a(E),{status:"ok"})},N={[e.ELEMENT_ACTION]:async({cmd:E,data:_})=>{_.status=="received"&&s({cmd:E,data:_}).catch(T=>{console.log(T)})},[e.CHECK_ELEMENT_VIDEO_SELECTED]:async({cmd:E,data:_})=>{const T=await s({cmd:E,data:_});T&&a(T)},[e.GET_TABS]:async({cmd:E,data:_})=>{const T=await s({cmd:E,data:_});T&&a(T)},[e.ADD_EVENTS_ELEMENT]:async({cmd:E,data:_})=>{await s({cmd:E,data:_})},[e.GET_VIDEO_INFO]:async({cmd:E,data:_})=>{a(await s({cmd:E,data:_}))},[e.DISPLAY_VIDEOS_ON_SELECTED_PAGE]:async({cmd:E,data:_})=>{await s({cmd:E,data:_})},[e.ENABLE_VIDEO_DETECTOR]:async({cmd:E,data:_})=>{s({cmd:E,data:_})},[e.DISABLE_VIDEO_DETECTOR]:async({cmd:E,data:_})=>{s({cmd:E,data:_})}};window.addEventListener("message",async function(E){const _=E.data;if(E.source!=window||_._isExtMsg)return;const T=N[_.cmd];if(T)try{await T(_)}catch(n){console.log(n)}},!1),chrome.runtime.onMessage.addListener(function(E,_,T){let n=A[E.cmd];return n?(n(E).then(t=>{T(t)}).catch(t=>{T({err:t})}),!0):!1}),console.log("ahiseve app")})();
