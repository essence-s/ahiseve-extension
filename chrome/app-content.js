(function(){const a={ELEMENT_ACTION:"ELEMENT_ACTION",GET_VIDEOS_DATA:"GET_VIDEOS_DATA",RESULT_VIDEOS_DATA:"RESULT_VIDEOS_DATA",GET_TABS:"GET_TABS",RESULT_TABS:"RESULT_TABS",CHECK_ELEMENT_VIDEO_SELECTED:"CHECK_ELEMENT_VIDEO_SELECTED",RESULT_CHECK_ELEMENT_VIDEO_SELECTED:"RESULT_CHECK_ELEMENT_VIDEO_SELECTED",ADD_EVENTS_ELEMENT:"ADD_EVENTS_ELEMENT",REMOVE_EVENTS_ELEMENTS:"REMOVE_EVENTS_ELEMENTS",CHECK_CONNECTION:"CHECK_CONNECTION",APP_INSTANCE_ALIVE:"APP_INSTANCE_ALIVE",APP_INSTANCE_LOST_PRIMARY:"APP_INSTANCE_LOST_PRIMARY",APP_INSTANCE_NOW_PRIMARY:"APP_INSTANCE_NOW_PRIMARY"},n=E=>new Promise((e,s)=>{chrome.runtime.sendMessage(E,t=>{chrome.runtime.lastError?s(chrome.runtime.lastError.message):e(t)})}),T=E=>{window.postMessage(E,"*")};n({cmd:a.APP_INSTANCE_ALIVE,tabId:chrome.runtime.id});const o={[a.APP_INSTANCE_NOW_PRIMARY]:async()=>(console.log("Ahiseve extension:","ahora la pesta\xF1a Ahiseve esta conectado a la extension"),console.log("la extension solo puede conectarse con una pesta\xF1a de Ahiseve"),{status:"ok"}),[a.APP_INSTANCE_LOST_PRIMARY]:async()=>(console.log("Ahiseve extension:","esta pesta\xF1a dejo de ser la principal y se desconecto de la extension"),{status:"ok"}),ELEMENT_ACTION:async E=>(E.data.status=="sending"&&T({cmd:E.cmd,data:E.data}),{status:"ok"}),RESULT_VIDEOS_DATA:async E=>(T(E),{status:"ok"}),CHECK_CONNECTION:async()=>({message:"connected"})},A={ELEMENT_ACTION:(E,e)=>{e.status=="received"&&n({cmd:E,data:e}).catch(s=>{console.log(s)})},[a.CHECK_ELEMENT_VIDEO_SELECTED]:async(E,e)=>{const s=await n({cmd:E,data:e});s&&T(s)},[a.GET_TABS]:async(E,e)=>{const s=await n({cmd:E,data:e});s&&T(s)},[a.GET_VIDEOS_DATA]:async(E,e)=>{await n({cmd:E,data:e})},[a.ADD_EVENTS_ELEMENT]:async(E,e)=>{await n({cmd:E,data:e})}};window.addEventListener("message",async function(E){const e=E.data;if(E.source!=window||e._isExtMsg)return;let{cmd:s,data:t}=e;const _=await A[s];_&&_(s,t)},!1),chrome.runtime.onMessage.addListener(function(E,e,s){let t=o[E.cmd];if(t)return t(E,e).then(_=>{s(_)}).catch(_=>{s({err:_})}),!0;s({error:"no existe tal accion"})}),console.log("ahiseve app")})();
